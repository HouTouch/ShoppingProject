"use strict";(self["webpackChunkdemo1"]=self["webpackChunkdemo1"]||[]).push([[975],{8188:function(t,s,a){a.d(s,{A:function(){return r}});var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"count-box"},[s("button",{staticClass:"minus",on:{click:t.handleSub}},[t._v("-")]),s("input",{staticClass:"inp",attrs:{type:"text"},domProps:{value:t.value},on:{change:t.handleChange}}),s("button",{staticClass:"add",on:{click:t.handleAdd}},[t._v("+")])])},e=[],o={props:{value:{type:Number,default:1}},methods:{handleSub(){this.value<=1||this.$emit("input",this.value-1)},handleAdd(){this.$emit("input",this.value+1)},handleChange(t){const s=+t.target.value;isNaN(s)||s<1?t.target.value=this.value:this.$emit("input",s)}}},n=o,c=a(1656),l=(0,c.A)(n,i,e,!1,null,"c366c412",null),r=l.exports},1975:function(t,s,a){a.r(s),a.d(s,{default:function(){return g}});a(4114);var i=function(){var t=this,s=t._self._c;return t.detail.goods_name?s("div",{staticClass:"prodetail"},[s("van-nav-bar",{attrs:{fixed:"",title:"商品详情页","left-arrow":""},on:{"click-left":function(s){return t.$router.go(-1)}}}),s("van-swipe",{attrs:{autoplay:3e3},on:{change:t.onChange},scopedSlots:t._u([{key:"indicator",fn:function(){return[s("div",{staticClass:"custom-indicator"},[t._v(t._s(t.current+1)+" / "+t._s(t.images.length))])]},proxy:!0}],null,!1,3958565683)},t._l(t.images,(function(t,a){return s("van-swipe-item",{key:a},[s("img",{attrs:{src:t.external_url}})])})),1),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[s("div",{staticClass:"price"},[s("span",{staticClass:"now"},[t._v("￥"+t._s(t.detail.goods_price_max))]),s("span",{staticClass:"oldprice"},[t._v("￥"+t._s(t.detail.line_price_max))])]),s("div",{staticClass:"sellcount"},[t._v("已售"+t._s(t.detail.goods_sales)+"件")])]),s("div",{staticClass:"msg text-ellipsis-2"},[t._v(" "+t._s(t.detail.goods_name)+" ")]),s("div",{staticClass:"service",on:{click:t.showPopup}},[s("div",{staticClass:"left-words"},[s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v(t._s(t.service1.name))],1),s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v(t._s(t.service2.name))],1)]),s("div",{staticClass:"right-icon"},[s("van-icon",{attrs:{name:"arrow"}})],1)]),s("van-popup",{style:{height:"30%"},attrs:{position:"bottom",round:"","close-on-click-overlay":"",closeable:""},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[s("h2",{staticStyle:{"text-align":"center","margin-top":"10px"}},[t._v("服务")]),s("div",[s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v(t._s(t.service1.name))],1)]),s("div",[s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v(t._s(t.service2.name))],1)])])],1),s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-title"},[s("div",{staticClass:"left"},[t._v("商品评价 ("+t._s(t.total)+"条)")]),s("div",{staticClass:"right"},[t._v("查看更多 "),s("van-icon",{attrs:{name:"arrow"}})],1)]),s("div",{staticClass:"comment-list"},t._l(t.commentList,(function(a){return s("div",{key:a.comment_id,staticClass:"comment-item"},[s("div",{staticClass:"top"},[s("img",{attrs:{src:a.user.avatar_url,alt:""}}),s("div",{staticClass:"name"},[t._v(t._s(a.user.nick_name))]),s("van-rate",{attrs:{size:16,value:5,color:"#ffd21e","void-icon":"star","void-color":"#eee"}})],1),s("div",{staticClass:"content"},[t._v(" "+t._s(a.content)+" ")]),s("div",{staticClass:"time"},[t._v(" "+t._s(a.create_time)+" ")])])})),0)]),s("div",{staticClass:"desc",domProps:{innerHTML:t._s(t.detail.content)}}),s("div",{staticClass:"footer"},[s("div",{staticClass:"icon-home"},[s("van-icon",{attrs:{name:"wap-home-o"}}),s("span",{on:{click:function(s){return t.$router.push("/home")}}},[t._v("首页")])],1),s("div",{staticClass:"icon-cart"},[t.cartTotal>0?s("span",{staticClass:"num"},[t._v(t._s(t.cartTotal))]):t._e(),s("van-icon",{attrs:{name:"shopping-cart-o"}}),s("span",{on:{click:function(s){return t.$router.push("/cart")}}},[t._v("购物车")])],1),s("div",{staticClass:"btn-add",on:{click:t.addFn}},[t._v("加入购物车")]),s("div",{staticClass:"btn-buy",on:{click:t.buyFn}},[t._v("立刻购买")]),s("van-action-sheet",{attrs:{title:"cart"===t.mode?"加入购物车":"立刻购买"},model:{value:t.carshow,callback:function(s){t.carshow=s},expression:"carshow"}},[s("div",{staticClass:"product"},[s("div",{staticClass:"product-title"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:t.detail.goods_image,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[s("span",[t._v("¥")]),s("span",{staticClass:"nowprice"},[t._v(t._s(t.detail.goods_price_max))])]),s("div",{staticClass:"count"},[s("span",[t._v("库存")]),s("span",[t._v(t._s(t.detail.stock_total))])])])]),s("div",{staticClass:"num-box"},[s("span",[t._v("数量")]),s("CountBox",{model:{value:t.addCount,callback:function(s){t.addCount=s},expression:"addCount"}})],1),t.detail.stock_total>0?s("div",{staticClass:"showbtn"},["cart"===t.mode?s("div",{staticClass:"btn",on:{click:t.addCart}},[t._v("加入购物车")]):t._e(),"buy"===t.mode?s("div",{staticClass:"btn now",on:{click:t.goBuyNow}},[t._v("立刻购买")]):t._e()]):s("div",{staticClass:"btn-none"},[t._v("该商品已抢完")])])])],1)],1):t._e()},e=[],o=(a(8813),a(8612)),n=a(5720);const c=t=>n.A.get("/goods/detail",{params:{goodsId:t}}),l=t=>n.A.get("/goods.service/list",{params:{goodsId:t}}),r=(t,s)=>n.A.get("/comment/listRows",{params:{goodsId:t,limit:s}});var d=a(9652),u=a(8188),v={data(){return{}},methods:{loginConfirm(){return!this.$store.getters.token&&(this.$dialog.confirm({title:"温馨提示",message:"此时需要先登录才能操作",confirmButtonText:"去登录",cancelButtonText:"再逛逛"}).then((()=>{this.$router.replace({path:"/login",query:{backUrl:this.$route.fullPath}})})).catch((()=>{})),!0)}}},m={name:"proDetail",mixins:[v],data(){return{detail:{},service:{},service1:{},service2:{},images:[],current:0,show:!1,commentList:[],total:0,carshow:!1,actions:[{name:"加入购物车"}],mode:"",addCount:1,cartTotal:0}},components:{CountBox:u.A},methods:{onChange(t){this.current=t},async getProDetail(){const{data:{detail:t}}=await c(this.goodsId);this.detail=t,this.images=t.goods_images,console.log(t);const{data:{list:s}}=await l(this.goodsId);this.service=s,this.service1=this.service[0],this.service2=this.service[1]},async getProDetailComment(){const{data:{list:t,total:s}}=await r(this.goodsId,3);this.commentList=t,this.total=s},showPopup(){this.show=!0},onSelect(t){this.carshowshow=!1,(0,o.A)(t.name)},addFn(){this.carshow=!0,this.mode="cart"},buyFn(){this.carshow=!0,this.mode="buy"},async addCart(){if(this.loginConfirm())return;const{data:t}=await(0,d.U4)(this.goodsId,this.addCount,this.detail.skuList[0].goods_sku_id);this.cartTotal=t.cartTotal,console.log(this.cartTotal),this.carshow=!1,console.log("加入成功")},goBuyNow(){this.loginConfirm()||this.$router.push({path:"/pay",query:{mode:"buyNow",goodsId:this.goodsId,goodsSkuId:this.detail.skuList[0].goods_sku_id,goodsNum:this.addCount}})}},computed:{goodsId(){return this.$route.params.id}},async created(){this.getProDetail(),this.getProDetailComment()}},h=m,p=a(1656),_=(0,p.A)(h,i,e,!1,null,"23f1c342",null),g=_.exports}}]);
//# sourceMappingURL=975.5d03508f.js.map